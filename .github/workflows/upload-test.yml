name: Manual SARIF Upload Test

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # 手動実行ボタンを有効化

jobs:
  upload-sarif:
    runs-on: ubuntu-latest
    permissions:
      # SARIFアップロードには security-events: write が必須
      security-events: write
      actions: read
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Fix SARIF URIs
        run: |
          # "zap-results.sarif" は実際のファイル名に合わせてください
          # "https://www.example.com/" の部分はスキャン対象のURLに合わせてください
          # 例: https://localhost:8000/app/login -> app/login に変換されます
          sed -i 's|https://www.example.com/||g' zap-results.sarif
      - name: Upload SARIF file
        uses: github/codeql-action/upload-sarif@v3
        with:
          # 手順1で作ったファイル名を指定
          sarif_file: zap-dummy.sarif
          # ツール名を明示（管理画面で分かりやすくするため）
          category: manual-test